#!/bin/bash
set -e

if [[ $1 == "config" ]]; then
  echo 'graph_title CEPH total capacity'
  echo 'graph_category ceph'
  echo 'graph_vlabel Bytes'
  echo 'graph_info CEPH cluster capacity'
  echo 'graph_args -l 0'
  echo "capacity.label Capacity"
  echo "free.label Free"
  echo "data.label Data stored"

  exit 0
fi

tmpfile=$(mktemp)
ceph insights > $tmpfile

echo "capacity.value $(cat $tmpfile | jq '.["df"]["stats"]["total_bytes"]')"
echo "free.value $(cat $tmpfile | jq '.["df"]["stats"]["total_avail_bytes"]')"
echo "data.value $(cat $tmpfile | jq '.["df"]["stats"]["total_used_raw_bytes"]')"

rm $tmpfile
